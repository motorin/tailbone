/*
   app-dust-backbone - v0.0.0
*/
(function(){var a;(a=window.Inn)==null&&(window.Inn={}),Inn.Model=Backbone.Model.extend({url:function(){return"app/models/"+this.id+".json"}})}).call(this),function(){var a;(a=window.Inn)==null&&(window.Inn={}),Inn.Collection=Backbone.Collection.extend({url:function(){return"#"},model:Inn.Model})}.call(this),function(){var a,b={}.hasOwnProperty;(a=window.Inn)==null&&(window.Inn={}),Inn.ViewsCollection=function(){function a(){this._list={}}return a.prototype.add=function(a){var b,c;return this._list[(b=a.id)!=null?b:a.cid]==null&&(this._list[(c=a.id)!=null?c:a.cid]=a),this},a.prototype.remove=function(a){var b;return this._list[(b=a.id)!=null?b:a.cid]=void 0,this},a.prototype.render=function(){var a,c,d;d=this._list;for(a in d){if(!b.call(d,a))continue;c=d[a],c.on("ready",this.viewReadyHandler,this),c.render()}return this},a.prototype.stopRender=function(){var a,c,d;d=this._list;for(a in d){if(!b.call(d,a))continue;c=d[a],c.off("ready"),c.stopRender()}return this},a.prototype.viewReadyHandler=function(){return this.isRendered()&&(this.trigger("ready"),this.off("ready")),this},a.prototype.isRendered=function(){var a,c,d;d=this._list;for(a in d){if(!b.call(d,a))continue;c=d[a];if(!c.ready)return!1}return!0},a.prototype.get=function(a,b){return b==null&&(b=!1),this._list[a]},a.prototype.reset=function(){var a,c,d;d=this._list;for(a in d){if(!b.call(d,a))continue;c=d[a],c.ready=!1}return this},a.prototype.destroy=function(){var a,b,c;c=this._list;for(a in c)b=c[a],b.destroy();return this._list={},this},a.prototype.isEmpty=function(){var a,c;c=this._list;for(a in c){if(!b.call(c,a))continue;return!1}return!0},_.extend(a.prototype,Backbone.Events),a}()}.call(this),function(){var a;(a=window.Inn)==null&&(window.Inn={}),Inn.View=Backbone.View.extend({initialize:function(a,b){var c,d;return this.partials=b!=null?b:null,this.partials=(c=(d=this.partials)!=null?d:this.options.partials)!=null?c:[],this.children=new Inn.ViewsCollection,this._parent=null,this.ready=!1,this._rendering=!1},destroy:function(){return this.parent=null,this.children.destroy(),this.trigger("destroyed",this),this},render:function(a,b){var c=this;return a==null&&(a=!1),b==null&&(b=!0),this._rendering&&this.stopRender(),this._rendering=!0,this.$el.data("view-template")!=null&&(this.options.templateName=this.$el.data("view-template")),this._loadTemplate(function(d){var e;return require((e=c.options.i18nRequire)!=null?e:[],function(){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;c._$memorizedEl=c.$el,c.$el=c.$el.clone(!0,!0),c.el=c.$el.get(),c.$el.html(d((p=(q=(r=c.options.model)!=null?r.toJSON():void 0)!=null?q:(s=c.options.dataManager)!=null?s.getDataAsset():void 0)!=null?p:{})),j=_.clone(c.options),j.partials=[],t=c.partials;for(h=l=0,n=t.length;l<n;h=++l)i=t[h],g=c.children.get((u=i.id)!=null?u:i.cid),e=c.$el.find("#"+i.id),g!=null?g.setElement(e):(i instanceof Inn.View?(k=i,k.options=_.extend({},j,k.options),k.setElement(e.get(0))):k=new Inn.View(_.extend({},j,{el:e.get(0)},i)),k._parent=c,c.children.add(k));v=c.pullChildren();for(h=m=0,o=v.length;m<o;h=++m)f=v[h],c.initPartial(f,j,!1);return a||c.children.isEmpty()?(c.isRoot()||(c.ready=!0),c._rendering=!1,b?c.replaceContext():c.trigger("readyForReplacement",c),c.trigger("ready")):(c.children.on("ready",_.bind(c._readyHandler,c,b)),c.children.render())})}),this},initPartial:function(a,b,c){var d,e;return b==null&&(b={}),c==null&&(c=!1),d=$(a),d.removeClass(this.options.partialClassName),e=new Inn.View(_.extend({},b,{el:d.get(0),id:d.attr("id")},d.data("view-options"))),e._parent=this,c||this.children.add(e),e},replaceContext:function(){return this._$memorizedEl.replaceWith(this.$el),this._$memorizedEl=void 0},_readyHandler:function(a){return this.isRoot()||(this.ready=!0),this.children.reset(),this._rendering=!1,a?this.replaceContext():this.trigger("readyForReplacement",this),this.trigger("ready")},stopRender:function(){return this._rendering=!1,this.off("ready",this._readyHandler,this),this.children.stopRender(),this},_loadTemplate:function(a){var b,c=this;return b=function(){try{return jade.templates[c._getTemplateName()].apply(null,arguments)}catch(a){return typeof window.console!="undefined"&&typeof window.console.debug=="function"&&console.debug("tailbone view error ["+c._getTemplateName()+"]:",a.toString()),""}},jade.templates[this._getTemplateName()]!=null?setTimeout(function(){return a.call(this,b)}):$.getScript(this._getTemplateURL(),function(){return a.call(this,b)}),this},_getTemplateURL:function(){var a;return a=this.options.templateFolder?"/":"",this.options.templateURL==null?this.options.templateFolder+a+this._getTemplateName()+"."+this.options.templateFormat:this.options.templateURL},_getTemplateName:function(){return this.options.templateName?this.options.templateName:"b"+this.id[0].toUpperCase()+this.id.slice(1)},pullChildren:function(){return this.$el.find("."+this.options.partialClassName)},reInitPartial:function(a){var b;return b=a.options,this.children.remove(a),this.children.add(this.initPartial(a.$el,b).render()),a.destroy()},isRoot:function(){return this._parent===null},options:{partialClassName:"bPartial",templateFolder:"",templateFormat:"js"}})}.call(this),function(){var a;(a=window.Inn)==null&&(window.Inn={}),Inn.DataManager=function(){function a(){this._dataSets=[],_.extend(this,Backbone.Events)}return a.prototype.addDataAsset=function(a,b){if(a instanceof Inn.Model||a instanceof Inn.Collection){if(!a.id&&!b)throw new Inn.Error("dataAsset id is required");return b&&(a.id=b),_.indexOf(this._dataSets,a)===-1&&this._dataSets.push(a),this.trigger("add:dataAsset",a),this}throw new Inn.Error("dataAsset shold be an instance of Inn.Model or Inn.Collection")},a.prototype.getDataAsset=function(a){var b;return b=_.find(this._dataSets,function(b){return b.id===a}),b!=null?b:null},a.prototype.removeDataAsset=function(a){var b;return b=_.reject(this._dataSets,function(b){return b.id===a}),this._dataSets.length===b.length?null:(this._dataSets=b,this.trigger("remove:dataAsset"))},a.prototype.destroy=function(){var a;return a=this,_.each(this._dataSets,function(b){return a.removeDataAsset(b.id)})},a}()}.call(this);