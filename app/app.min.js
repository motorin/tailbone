/*
   app-dust-backbone - v0.0.0
*/
(function(){var a;(a=window.Inn)==null&&(window.Inn={}),Inn.Model=Backbone.Model.extend({url:function(){return"app/models/"+this.id+".json"}})}).call(this),function(){var a;(a=window.Inn)==null&&(window.Inn={}),Inn.Collection=Backbone.Collection.extend({url:function(){return"#"},model:Inn.Model})}.call(this),function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};(a=window.Inn)==null&&(window.Inn={}),Inn.ViewsCollection=function(){function a(){this._list=[]}return a.prototype.add=function(a){return b.call(this._list,a)<0&&(this._list.push(a),a.on("destroy",this.viewDestroyHandler)),this},a.prototype.render=function(){var a,b,c,d;d=this._list;for(b=0,c=d.length;b<c;b++)a=d[b],a.on("ready",this.viewReadyHandler,this),a.render();return this},a.prototype.stopRender=function(){var a,b,c,d;d=this._list;for(b=0,c=d.length;b<c;b++)a=d[b],a.off("ready"),a.stopRender();return this},a.prototype.viewDestroyHandler=function(a){return this.trigger("destroy",a)},a.prototype.viewReadyHandler=function(){return this.isRendered()&&(this.trigger("ready"),this.off("ready")),this},a.prototype.isRendered=function(){return _.filter(this._list,function(a){return!a.ready}).length===0},a.prototype.get=function(a,b){return b==null&&(b=!1),_.find(this._list,function(b){return b.id===a})},a.prototype.reset=function(){var a,b,c,d;d=this._list;for(b=0,c=d.length;b<c;b++)a=d[b],a.ready=!1;return this},a.prototype.destroy=function(){var a,b,c,d;d=this._list;for(b=0,c=d.length;b<c;b++)a=d[b],a.destroy();return this},a.prototype.isEmpty=function(){return!this._list.length},_.extend(a.prototype,Backbone.Events),a}()}.call(this),function(){var a;(a=window.Inn)==null&&(window.Inn={}),Inn.View=Backbone.View.extend({initialize:function(a,b){var c,d;return this.partials=b!=null?b:null,this.partials=(c=(d=this.partials)!=null?d:this.options.partials)!=null?c:[],this.children=new Inn.ViewsCollection,this._parent=null,this.ready=!1,this._rendering=!1},destroy:function(){return this.parent=null,this.remove(),this.children.destroy(),this.trigger("destroy",this),this},render:function(){var a=this;return this._rendering&&this.stopRender(),this._rendering=!0,this._loadTemplate(function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;a.$el.html(b((m=(n=a.options.dataManager)!=null?n.getDataAsset():void 0)!=null?m:{})),g=_.clone(a.options),g.partials=[],o=a.partials;for(e=i=0,k=o.length;i<k;e=++i)f=o[e],c=a.$el.find("#"+f.id),f instanceof Inn.View?(h=f,h.options=_.extend({},g,h.options),h.setElement(c.get(0))):h=new Inn.View(_.extend({},g,{el:c.get(0)},f)),h._parent=a,a.children.add(h);p=a.pullChildren();for(e=j=0,l=p.length;j<l;e=++j)d=p[e],c=$(d),c.removeClass(a.options.partialClassName),h=new Inn.View(_.extend({},g,{el:c.get(0),id:c.attr("id")},c.data("view-options"))),h._parent=a,c.data("view-template")!=null&&(h.options.templateName=c.data("view-template")),a.children.add(h);return a.children.isEmpty()?(a.isRoot()||(a.ready=!0),a._rendering=!1,a.trigger("ready")):a.children.on("ready",a._readyHandler,a),a.children.render()}),this},_readyHandler:function(){return this.isRoot()||(this.ready=!0),this.children.reset(),this._rendering=!1,this.trigger("ready")},stopRender:function(){return this._rendering=!1,this.off("ready",this._readyHandler,this),this.children.stopRender(),this},_loadTemplate:function(a){var b,c=this;return b=function(){var b;return b=function(a){var b;return b="",dust.render(c._getTemplateName(),a!=null?a:{},function(a,c){return b=c}),b},a.call(c,b)},dust.cache[this._getTemplateName()]!=null?setTimeout(function(){return b()}):$.getScript(this._getTemplateURL(),b),this},_getTemplateURL:function(){var a;return a=this.options.templateFolder?"/":"",this.options.templateURL==null?this.options.templateFolder+a+this._getTemplateName()+"."+this.options.templateFormat:this.options.templateURL},_getTemplateName:function(){return this.options.templateName?this.options.templateName:"b"+this.id[0].toUpperCase()+this.id.slice(1)},pullChildren:function(){return this.$el.find("."+this.options.partialClassName)},isRoot:function(){return this._parent===null},options:{partialClassName:"bPartial",templateFolder:"",templateFormat:"js"}})}.call(this),function(){var a;(a=window.Inn)==null&&(window.Inn={}),Inn.DataManager=function(){function a(){this._dataSets=[],_.extend(this,Backbone.Events)}return a.prototype.addDataAsset=function(a,b){if(a instanceof Inn.Model||a instanceof Inn.Collection){if(!a.id&&!b)throw new Inn.Error("dataAsset id is required");return b&&(a.id=b),_.indexOf(this._dataSets,a)===-1&&this._dataSets.push(a),this.trigger("add:dataAsset",a),this}throw new Inn.Error("dataAsset shold be an instance of Inn.Model or Inn.Collection")},a.prototype.getDataAsset=function(a){var b;return b=_.find(this._dataSets,function(b){return b.id===a}),b!=null?b:null},a.prototype.removeDataAsset=function(a){var b;return b=_.reject(this._dataSets,function(b){return b.id===a}),this._dataSets.length===b.length?null:(this._dataSets=b,this.trigger("remove:dataAsset"))},a.prototype.destroy=function(){var a;return a=this,_.each(this._dataSets,function(b){return a.removeDataAsset(b.id)})},a}()}.call(this);